--- a/amd/amdgpu/dce_v6_0.c.orig	2019-10-16 23:26:18.244587835 -0700
+++ b/amd/amdgpu/dce_v6_0.c	2019-10-16 23:28:26.912606147 -0700
@@ -1426,6 +1426,9 @@ static void dce_v6_0_audio_set_avi_infof
 	struct amdgpu_device *adev = dev->dev_private;
 	struct amdgpu_encoder *amdgpu_encoder = to_amdgpu_encoder(encoder);
 	struct amdgpu_encoder_atom_dig *dig = amdgpu_encoder->enc_priv;
+#if DRM_VERSION_CODE >= DRM_VERSION(5, 1, 0)
+	struct drm_connector *connector = amdgpu_get_connector_for_encoder(encoder);
+#endif
 	struct hdmi_avi_infoframe frame;
 	u8 buffer[HDMI_INFOFRAME_HEADER_SIZE + HDMI_AVI_INFOFRAME_SIZE];
 	uint8_t *payload = buffer + 3;
@@ -1433,10 +1436,12 @@ static void dce_v6_0_audio_set_avi_infof
 	ssize_t err;
 	u32 tmp;
 
-#if DRM_VERSION_CODE < DRM_VERSION(4, 14, 0) && \
+#if DRM_VERSION_CODE >= DRM_VERSION(5, 1, 0)
+	err = drm_hdmi_avi_infoframe_from_display_mode(&frame, connector, mode);
+#elif DRM_VERSION_CODE < DRM_VERSION(4, 14, 0) && \
 	!defined(OS_NAME_SUSE_15) && !defined(OS_NAME_SUSE_15_1)
 	err = drm_hdmi_avi_infoframe_from_display_mode(&frame, mode);
-#else
+#elif DRM_VERSION_CODE < DRM_VERSION(5, 1, 0)
 	err = drm_hdmi_avi_infoframe_from_display_mode(&frame, mode, false);
 #endif
 	if (err < 0) {
