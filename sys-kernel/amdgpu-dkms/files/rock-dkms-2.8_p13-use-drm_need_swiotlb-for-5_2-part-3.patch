--- a/amd/amdgpu/gmc_v9_0.c.orig	2019-10-04 15:51:20.450841000 -0700
+++ b/amd/amdgpu/gmc_v9_0.c	2019-10-04 16:56:17.883997129 -0700
@@ -1193,7 +1193,11 @@ static int gmc_v9_0_sw_init(void *handle
 		pci_set_consistent_dma_mask(adev->pdev, DMA_BIT_MASK(32));
 		printk(KERN_WARNING "amdgpu: No coherent DMA available.\n");
 	}
+#if DRM_VERSION_CODE >= DRM_VERSION(5, 2, 0)
+	adev->need_swiotlb = drm_need_swiotlb(dma_bits);
+#else
 	adev->need_swiotlb = drm_get_max_iomem() > ((u64)1 << dma_bits);
+#endif
 
 	if (adev->gmc.xgmi.supported) {
 		r = gfxhub_v1_1_get_xgmi_info(adev);
