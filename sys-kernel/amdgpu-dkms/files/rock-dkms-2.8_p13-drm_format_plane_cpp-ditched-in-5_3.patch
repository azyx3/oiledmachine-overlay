--- a/amd/amdgpu/amdgpu_fb.c.orig	2019-10-03 05:15:41.483119350 -0700
+++ b/amd/amdgpu/amdgpu_fb.c	2019-10-03 06:01:01.102209940 -0700
@@ -135,6 +135,9 @@ static int amdgpufb_create_pinned_object
 					 struct drm_mode_fb_cmd2 *mode_cmd,
 					 struct drm_gem_object **gobj_p)
 {
+#if DRM_VERSION_CODE >= DRM_VERSION(5, 3, 0)
+	const struct drm_format_info *info;
+#endif
 	struct amdgpu_device *adev = rfbdev->adev;
 	struct drm_gem_object *gobj = NULL;
 	struct amdgpu_bo *abo = NULL;
@@ -149,7 +152,12 @@ static int amdgpufb_create_pinned_object
 			       AMDGPU_GEM_CREATE_VRAM_CLEARED 	     |
 			       AMDGPU_GEM_CREATE_CPU_GTT_USWC;
 
+#if DRM_VERSION_CODE >= DRM_VERSION(5, 3, 0)
+	info = drm_get_format_info(adev->ddev, mode_cmd);
+	cpp = info->cpp[0];
+#elif DRM_VERSION_CODE < DRM_VERSION(5, 3, 0)
 	cpp = drm_format_plane_cpp(mode_cmd->pixel_format, 0);
+#endif
 
 	/* need to align pitch with crtc limits */
 	mode_cmd->pitches[0] = amdgpu_align_pitch(adev, mode_cmd->width, cpp,
