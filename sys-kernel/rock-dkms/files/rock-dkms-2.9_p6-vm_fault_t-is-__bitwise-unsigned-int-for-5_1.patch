--- a/amd/amdkfd/kfd_doorbell.c.orig	2019-09-25 12:13:06.000000000 -0700
+++ b/amd/amdkfd/kfd_doorbell.c	2019-10-17 01:20:56.453526988 -0700
@@ -156,7 +156,11 @@ static void kfd_doorbell_close(struct vm
 }
 
 
-#ifndef HAVE_2ARGS_VIRTUAL_MM_FAULT_FUNCTION
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5, 1, 0)
+static vm_fault_t kfd_doorbell_vm_fault(struct vm_fault *vmf)
+{
+	struct kfd_process_device *pdd = vmf->vma->vm_private_data;
+#elif LINUX_VERSION_CODE >= KERNEL_VERSION(4, 11, 0) && LINUX_VERSION_CODE < KERNEL_VERSION(5, 1, 0) && !defined(HAVE_2ARGS_VIRTUAL_MM_FAULT_FUNCTION)
 static int kfd_doorbell_vm_fault(struct vm_fault *vmf)
 {
 	struct kfd_process_device *pdd = vmf->vma->vm_private_data;
