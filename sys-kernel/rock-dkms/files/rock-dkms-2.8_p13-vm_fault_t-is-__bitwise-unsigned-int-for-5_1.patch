--- a/amd/amdkfd/kfd_doorbell.c.orig	2019-10-03 05:15:41.515120608 -0700
+++ b/amd/amdkfd/kfd_doorbell.c	2019-10-03 12:29:07.220864121 -0700
@@ -156,7 +156,11 @@ static void kfd_doorbell_close(struct vm
 }
 
 
-#if LINUX_VERSION_CODE >= KERNEL_VERSION(4, 11, 0)
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5, 1, 0)
+static vm_fault_t kfd_doorbell_vm_fault(struct vm_fault *vmf)
+{
+	struct kfd_process_device *pdd = vmf->vma->vm_private_data;
+#elif LINUX_VERSION_CODE >= KERNEL_VERSION(4, 11, 0) && LINUX_VERSION_CODE < KERNEL_VERSION(5, 1, 0)
 static int kfd_doorbell_vm_fault(struct vm_fault *vmf)
 {
 	struct kfd_process_device *pdd = vmf->vma->vm_private_data;
