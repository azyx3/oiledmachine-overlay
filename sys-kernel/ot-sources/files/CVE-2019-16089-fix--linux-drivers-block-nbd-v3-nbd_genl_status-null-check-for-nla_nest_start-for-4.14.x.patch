Original patch from: Navid Emamdoost
For original see:
v2: https://lore.kernel.org/patchwork/patch/1106884/
v3: https://lore.kernel.org/patchwork/patch/1126650/
Adapted for 4.14.x (untested)

--- a/drivers/block/nbd.c.orig	2019-11-30 13:03:54.688245558 -0800
+++ b/drivers/block/nbd.c	2019-11-30 13:15:44.156102007 -0800
@@ -2148,6 +2148,12 @@ static int nbd_genl_status(struct sk_buf
 	}
 
 	dev_list = nla_nest_start(reply, NBD_ATTR_DEVICE_LIST);
+	if (!dev_list) {
+		nlmsg_free(reply);
+		ret = -EMSGSIZE;
+		goto out;
+	}
+
 	if (index == -1) {
 		ret = idr_for_each(&nbd_index_idr, &status_cb, reply);
 		if (ret) {
